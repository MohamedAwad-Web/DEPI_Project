@model Bookify.Core.Models.RoomDetailsViewModel

@{
    ViewData["Title"] = $"Room {Model.Room.RoomNumber} - {Model.Room.RoomType?.Name}";
}

<div class="container mt-4">
    <div class="row">
        <!-- Room Info -->
        <div class="col-lg-8">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Index">Home</a></li>
                    <li class="breadcrumb-item active">Room @Model.Room.RoomNumber</li>
                </ol>
            </nav>

            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h2>Room @Model.Room.RoomNumber - @Model.Room.RoomType?.Name</h2>
                        <span class="badge @(Model.Room.IsAvailable ? "bg-success" : "bg-danger") fs-6">
                            @(Model.Room.IsAvailable ? "Available" : "Occupied")
                        </span>
                    </div>

                    <p class="lead text-muted">@Model.Room.RoomType?.Description</p>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h5>Room Features</h5>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-people text-primary"></i> <strong>Max Guests:</strong> @Model.Room.RoomType?.MaxGuests</li>
                                <li><i class="bi bi-currency-dollar text-primary"></i> <strong>Price per night:</strong> $@Model.Room.RoomType?.Price</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Amenities</h5>
                            <ul class="list-unstyled">
                                <li><i class="bi bi-wifi text-primary"></i> Free WiFi</li>
                                <li><i class="bi bi-tv text-primary"></i> Flat Screen TV</li>
                                <li><i class="bi bi-thermometer-snow text-primary"></i> Air Conditioning</li>
                                <li><i class="bi bi-cup-hot text-primary"></i> Tea/Coffee Maker</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Booking Form -->
        <div class="col-lg-4">
            <div class="card sticky-top" style="top: 20px;">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-calendar-check"></i> Book This Room</h5>
                </div>
                <div class="card-body">
                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle"></i> @TempData["Error"]
                        </div>
                    }

                    <form method="post" asp-action="AddToCart">
                        <input type="hidden" name="roomId" value="@Model.Room.Id" />

                        <div class="mb-3">
                            <label for="checkInDate" class="form-label">Check-in Date</label>
                            <input type="date" class="form-control" id="checkInDate" name="checkInDate"
                                   value="@Model.CheckInDate.ToString("yyyy-MM-dd")"
                                   min="@DateTime.Today.ToString("yyyy-MM-dd")" required>
                        </div>

                        <div class="mb-3">
                            <label for="checkOutDate" class="form-label">Check-out Date</label>
                            <input type="date" class="form-control" id="checkOutDate" name="checkOutDate"
                                   value="@Model.CheckOutDate.ToString("yyyy-MM-dd")"
                                   min="@DateTime.Today.AddDays(1).ToString("yyyy-MM-dd")" required>
                        </div>

                        <div class="mb-3 p-3 bg-light rounded">
                            <div class="d-flex justify-content-between">
                                <span>Price per night:</span>
                                <strong>$@Model.Room.RoomType?.Price</strong>
                            </div>
                            <div class="d-flex justify-content-between mt-2">
                                <span>Total nights:</span>
                                <strong id="nightCount">1</strong>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <span><strong>Total:</strong></span>
                                <strong id="totalPrice">$@Model.Room.RoomType?.Price</strong>
                            </div>
                        </div>

                        @if (Model.Room.IsAvailable)
                        {
                            <button type="submit" class="btn btn-primary w-100 btn-lg">
                                <i class="bi bi-cart-plus"></i> Add to Cart
                            </button>
                        }
                        else
                        {
                            <button type="button" class="btn btn-secondary w-100 btn-lg" disabled>
                                <i class="bi bi-calendar-x"></i> Not Available
                            </button>
                        }
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Calculate nights and total price
        function calculateTotal() {
            const checkIn = new Date(document.getElementById('checkInDate').value);
            const checkOut = new Date(document.getElementById('checkOutDate').value);
            const pricePerNight = @(Model.Room.RoomType?.Price ?? 0);

            if (checkIn && checkOut && checkOut > checkIn) {
                const nights = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));
                document.getElementById('nightCount').textContent = nights;
                document.getElementById('totalPrice').textContent = '$' + (nights * pricePerNight).toFixed(2);
            }
        }

        document.getElementById('checkInDate').addEventListener('change', function() {
            const checkOutDate = document.getElementById('checkOutDate');
            checkOutDate.min = this.value;
            if (checkOutDate.value < this.value) {
                checkOutDate.value = this.value;
            }
            calculateTotal();
        });

        document.getElementById('checkOutDate').addEventListener('change', calculateTotal);

        // Initial calculation
        calculateTotal();
    </script>
}